##变量、作用域和内存

- 基本类型：简单的数据段，undefined、null、boolean、number、string，不能添加属性
- 引用类型：多个值构成的对象，保存在内存中，操作的是对象的引用，可以添加、改变、删除属性和方法

```js
var person = {};
person.name = 'shabi';

var name = 'shabi';
name.age = 27;

// name.age : undefined
```

- 复制基本类型的变量，是完全独立的 // var foo = 1;var bar = foo; foo与bar完全独立
- 复制引用类型的变量，副本实际上是一个指针，复制结束后，两个变量引用同一个对象，改变一个会影响另一个

```js
var obj1 = {};
var obj2 = obj1;
obj1.name = 'shabi';

//obj2.name : 'shabi'
```

- 函数的参数可以理解为局部变量，函数内部修改了参数值不改变其原始引用，局部对象会在函数执行完毕后销毁

```js
function setName(obj){
	obj.name = 'shabi';
	obj = {};
	obj.name = 'ha';
}
var person = {};
setName(person);
//person.name : 'shabi'
```

- `typeof` 检测基本类型: string number boolean undefined
- `instanceof` 检测引用类型: object null，检测基本类型会返回false
- 所有引用类型的值都是Object的实例
- **作用域链** 保证对执行环境有权访问的所有变量和函数的有序访问 [^1]

```js
var color = 'blue';
function changeColor(){
	if(color === 'blue'){
		color = 'red';
	}else{
		color = 'blue';
	}
}
changeColor();
// color: 'red'
// changeColor的作用域链包含两个对象：变量对象和全局环境的变量对象
```


- 在局部作用域定义的变量可以在局部环境中与全局变量互换

```js
var color = 'blue';
function changeColor(){
	var anotherColor = 'red';
	function swapColor(){
		var tempColor = anotherColor;
		anotherColor = color;
		color = tempColor;
	}
	swapColor();
}
changeColor();
// color: 'red'

|--- window
	|--- color
	|--- changeColor()
		|--- anotherColor
		|--- swapColor()
			|--- tempColor
```


- 内部环境可以通过作用域链访问所有外部环境，外部环境不能访问内部
- 函数参数可以被当做变量，访问规则与环境中的其他变量相同
- `try-catch`中的`catch` 可以延长作用域链
- `if` `for (i)` 会将变量添加到当前执行环境中
- 作用域链搜索中找到就停止
- 数据不再使用时，将其设置为null接触引用，脱离执行环境

```js
function createPerson(name){
	var localPerson = {};
	localPerson.name = name;
	return localPerson;
}
var globalPerson = createPerson('shabi');
globalPerson = null; // 手动解除globalPerson的引用
```


- 基本类型的值占据固定大小的内存，保存在栈内存中
- 引用类型的值是对象，保存在堆内存中