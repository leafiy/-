##表单脚本

###表单基础知识

- 表单对应的是 `HTMLFormElement` 类型，有下列属性和方法

|属性、方法|描述|
|:--:|--|
|`acceptCharset`|服务器能够处理的字符集；等价于HTML中的accept-charset特性|
|`action`|接受请求的URL；等价于HTML中的action特性|
|`elements`|表单中所有控件的集合（HTMLCollection）|
|`enctype`|请求的编码类型；等价于HTML中的enctype特性|
|`length`|表单中控件的数量|
|`method`|要发送的HTTP请求类型，通常是"get"或"post"；等价于HTML的method特性|
|`name`|表单的名称；等价于HTML的name特性|
|`reset()`|将所有表单域重置为默认值|
|`submit()`|提交表单|
|`target`|用于发送请求和接收响应的窗口名称；等价于HTML的target特性|

####提交表单

- 使用提交按钮在提交请求发送给服务器之前触发 `submit` 事件，阻止 `submit` 默认行为可以取消提交
- `form.submit()` 提交不会触发 `submit` 事件

####重置表单

- 重置按钮与 `form.reset()` 都会触发 `reset` 事件

####表单字段

- 每个表单都由 `elements` 属性，包含表单中所有元素的集合，可以按照 `name` 特性访问，如果表单中有同名元素，则返回 `NodeList`

```js
var form = document.getElementById('form');
form.elements[0]; // 表单中第一个字段
form.elements['textbox']; // 名为 textbox 的字段
form.elements.length; // 字段数量
```

#####共有的表单字段属性

|属性|说明（除了 `form` 属性，都可以修改）|
|:--:|--|
|`disabled`|布尔值，表示当前字段是否被禁用|
|`form`|指向当前字段所属表单的指针；只读|
|`name`|当前字段的名称|
|`readOnly`|布尔值，表示当前字段是否只读|
|`tabIndex`|表示当前字段的切换（tab）序号|
|`type`|当前字段的类型，如"checkbox"、"radio"，等等|
|`value`|当前字段将被提交给服务器的值。对文件字段来说，这个属性是只读的，包含着文件在计算机中的路径|

字段的type属性

|说　　明	|HTML示例|	type属性的值|
|--|--|--|
|单选列表|	`<select>. . .</select>`|	"select-one"|
|多选列表|	`<select multiple>. . .</select>`|	"select-multiple"|
|自定义按钮|	`<button>. . .</button>`|	"submit"|
|自定义非提交按钮|	`<button type="button">. . .</button>`|	"button"|
|自定义重置按钮|	`<button type="reset">. . .</buton>`|	"reset"|
|自定义提交按钮|	`<button type="submit">. . .</buton>`|	"submit"|

#####共有的表单字段方法

> 在默认情况下，只有表单字段可以获得焦点。对于其他元素而言，如果先将其tabIndex属性设置为-1，然后再调用focus()方法，也可以让这些元素获得焦点

#####共有的表单字段事件

- `blur` 当前字段失去焦点时触发
- `change` 对于 `<input>` 和 `<textarea>` 元素，在它们失去焦点且 `value` 值改变时触发；对于 `<select>`，在其选项改变时触发。
- `focus` 当前字段获得焦点时触发

###文本框脚本

> 使用`value`属性读取或设置文本框的值，不要使用 `setAttribute()` 设置 `<input>` 元素的`value`特性，也不要去修改 `<textarea>` 元素的第一个子节点

####选择文本

- `select()` 选中 `input` `textarea` 中的文本并获取焦点

#####select事件

- 当用户选择文本框中的内容，或者使用 `select()` 时触发

#####取得选择的文本

- `selectionStart` 和 `selectionEnd` 这两个属性中保存的是基于0的数值，表示所选择文本的范围（即文本选区开头和结尾的偏移量）

```js
textbox.value.substring(textbox.selectionStart, textbox.selectionEnd)
```

#####选择部分文本

- `setSelectionRange()` 接收要选择文本的第一个和最后一个字符的索引

####过滤输入

#####屏蔽字符

- 通过 `keypress` 事件

```js
EventUtil.addHandler(el, 'keypress', function(e){
	e = EventUtil.getEvent(e);
	var target = Event.getTarget(e);
	var charCode = Event.getCharCode(e);
	var str = String.fromCharCode(charCode);
	if(!/\d/.test(str)){ // 只允许输入数值
		EventUtil.preventDefautl(el);
	}
})
```

#####操作剪贴板

- `beforecopy` 在发生复制操作前触发
- `copy` 在发生复制操作时触发
- `beforecut` 在发生剪切操作前触发
- `cut` 在发生剪切操作时触发
- `beforepaste` 在发生粘贴操作前触发
- `paste` 在发生粘贴操作时触发
- 通过 `beforecopy` `beforecut` `beforepaste` 事件可以在向剪贴板发送数据，或者从剪贴板取得数据之前修改数据
- 使用 `clipboardData`对象访问剪贴板中的内容
	- 在IE中，这个对象是 `window` 对象的属性
	- 在Firefox 4+、Safari和Chrome中，这个对象是相应 `event` 对象的属性
	- Firefox、Safari和Chorme中，只有在处理剪贴板事件期间 `clipboardData` 对象才有效
- `clipboardData` 对象有三个方法
	- `getData()` 用于从剪贴板中取得数据，它接受一个参数，即要取得的数据的格式。在IE中，有两种数据格式：`text` 和 `URL`。在Firefox、Safari和Chrome中，这个参数是一种MIME类型；不过，可以用 `text` 代表 `text/plain`
	- `setData()` 第一个参数也是数据类型，第二个参数是要放在剪贴板中的文本。第一个参数，IE支持 `text` 和 `URL`，而Safari和Chrome仍然只支持MIME类型。但是，与 `getData()` 方法不同的是，Safari和Chrome的 `setData()` 方法不能识别"text"类型。这两个浏览器在成功将文本放到剪贴板中后，都会返回true；否则，返回false
	- `clearData()`

```js
EventUtil.getClipboardText = function(e){
	var data = (e.clipboardData || window.clipboardData);
	return data.getData('text')
}

EventUtil.setClipboardText = function(e,value){
	if(e.clipboardData){
		return e.clipboardData.setData('text/plain', value)
	}else if(window.clipboardData) {
		return window.clipboardData('text',value)
	}
}
```

- `paste` 事件中，可以确定剪贴板中的值是否有效，如果无效，可以，取消默认的行为

```js
EventUtil.addHandler(el, 'paste', function(e){
	var text = EventUtil.getClipboardData(e);
	if(!/^\d*$/){  // 只有数值才能被粘贴
		EventUtil.preventDefault(e);
	}
})
```

####自动切换焦点

```html
<input type="text" maxlength="3">
<input type="text" maxlength="3">
<input type="text" maxlength="3">
```

```js
var inputs = document.getElementsByTagName('input');
for (var i = 0; i < inputs.length; i++) {
    var input = inputs[i];
    input.addEventListener('keyup',function(e){
        var length = this.value.length;
        var maxlength = this.maxLength;
        if(length == maxlength){
            if(this.nextElementSibling && this.nextElementSibling.tagName.toLowerCase() == 'input'){
                this.nextElementSibling.focus()
            }
        }
    })
}
```

####HTML5约束验证API - 略

###选择框脚本

- `<select>` `<option>` 属于 `HTMLSelectElement`，有以下方法
	- `add(newOption, relOption)` 向控件中插入新<option>元素，其位置在相关项（relOption）之前
	- `multiple` 布尔值，表示是否允许多项选择；等价于HTML中的multiple特性
	- `options` 控件中所有<option>元素的HTMLCollection
	- `remove(index)` 移除给定位置的选项
	- `selectedIndex` 基于0的选中项的索引，如果没有选中项，则值为-1。对多选控件，只保存选中项中第一项的索引
	- `size` 选择框中可见的行数；等价于HTML中的size特性
- 选择框的 `value` 属性
	- 如果没有选中的项，则选择框的value属性保存空字符串
	- 如果有一个选中项，而且该项的value特性已经在HTML中指定，则选择框的value属性等于选中项的value特性。即使value特性的值是空字符串，也同样遵循此条规则
	- 如果有一个选中项，但该项的value特性在HTML中未指定，则选择框的value属性等于该项的文本
	- 如果有多个选中项，则选择框的value属性将依据前两条规则取得第一个选中项的
- `option` 元素都有一个 `HTMLOptionElement` 对象
	- `index` 当前选项在options集合中的索引
	- `label` 当前选项的标签；等价于HTML中的label特性
	- `selected` 布尔值，表示当前选项是否被选中。将这个属性设置为true可以选中当前选项
	- `text` 选项的文本
	- `value` 选项的值（等价于HTML中的value特性）

```js
// 推荐使用非DOM方法获取opion属性
selectbox.options[0].text;
selectbox.options[0].value;
```

> 选择框的change事件与其他表单字段的change事件触发的条件不一样。其他表单字段的change事件是在值被修改且焦点离开当前字段时触发，而选择框的change事件只要选中了选项就会触发

####选择选项

- 对单选选择框，`selected` 设置为false无意义

```js
selectbox.options[0].selected = true;
var selectedItem = selectbox.options[selectbox.selectedIndex];
```

- 可多选的选择框设置 `selected` 属性不会取消其他选择项

```js
// 取得所有选中项
var result = [];
var option = null;
for(var i = 0;i < selectbox.options.length; i++){
	option = selectbox.options[i];
	if(option.selected){
		result.push(option)
	}
}
```

####添加选项

- 使用 `option` 构造函数新建

```js
var option = new Option('option text', 'option value');
selectbox.add(option,undefined)
```

- 新的 `option` 添加到指定位置，使用 `insertBefore()` 方法

####移除选项

```js
selectbox.remove(o) // 移除第一个选项
```

####移动和重排选项

- 用DOM的 `appendChild()` 方法，就可以将第一个选择框中的选项直接移动到第二个选择框中，如果为appendChild()方法传入一个文档中已有的元素，那么就会先从该元素的父节点中移除它，再把它添加到指定的位置

```js
var box1 = document.getElementById('box1');
var box2 = document.getElementById('box2');
box2.appendChild(box1.options[0]);
```

- 移动或重排选择框会重置每一个选项的 `index` 属性

###表单序列化

- 浏览器发送给服务器的数据
	- 对表单字段的名称和值进行URL编码，使用和号 `&` 分隔
	- 不发送禁用的表单字段
	- 只发送勾选的复选框和单选按钮
	- 不发送type为 `reset` `button` 的按钮
	- 多选选择框中的每个选中的值单独一个条目
	- 在单击提交按钮提交表单的情况下，也会发送提交按钮；否则，不发送提交按钮。也包括type为 `image` 的 `<input>` 元素
	- `<select>` 元素的值，就是选中的 `<option>` 元素的 `value` 特性的值。如果 `<option>` 元素没有 `value` 特性，则是 `<option>` 元素的文本值

####使用 `contenteditable` 属性

```html
<div contenteditable="ture"></div>
```
