##错误处理与调试

####try-catch语句

```js
try{
	// 可能会导致错误的代码
}catch(error){
	// 错误发生时怎样处理
}
```
**`error.message` 是唯一一个能够保证所有浏览器都支持的属性**

#####finally子句

- 只要代码中有 `finally` 子句，就肯定会执行，设置 `try - catch` 中包含 `return`
- 如有 `finally` 子句， 则 `catch` 子句就变成可选的

#####错误类型

- `Error` 基类型，其他错误类型都是继承自此类型
- `EvalError` 使用 `eval()` 函数时发生异常时抛出
- `RangeError` 在数值超出相应的范围时触发
- `ReferenceError` 访问不存在的变量
- `SyntaxError` 语法错误
- `TypeError` 变量中保存着意外类型时，或者访问不存在的方法时

```js
new Array(-20); // RangeError

var obj = x; // ReferenceError

var o = new 10; // TypeError
'name' in obj; // TypeError
Function.prototype.toString.call('name') // TypeError
```

- 使用 `instanceof` 判断错误类型 `error instanceof TypeError` 等

#####合理使用try-catch

- 当使用 `try-catch` 时，浏览器会认为错误已经处理过了
- 当明白代码会发生错误时使用

####抛出错误

- `throw` 操作符，用于随时抛出自定义错误，必须给 `throw` 一个值
- 在遇到 `throw` 操作符时，代码会停止运行，仅当有 `try-catch` 语句捕获被抛出的值时，才会继续

```js
// 使用原型链实现自定义Error
functoin CustomError(msg){
	this.name = 'CustomError';
	this.message = msg;
}
CustomError.prototype = new Error();
throw new CustomError('some message');
```

- 浏览器对继承自 `Error` 的自定义错误类型与其他错误类型一样

#####抛出错误的时机

- 出现某种特定的已知错误条件，导致函数无法正常执行时
- 重点关注函数和可能导致函数执行失败的因素

#####抛出错误与使用try-catch

- 只捕获确切知道该如何处理的错误

```js
try{
  var x=document.getElementById("demo").value;
  if(x=="")    throw "empty";
  if(isNaN(x)) throw "not a number";
  if(x>10)     throw "too high";
  if(x<5)      throw "too low";
}catch(err){
  var y=document.getElementById("mess");
  y.innerHTML="Error: " + err + ".";
 }
```

####错误事件

- 没有经 `try-catch` 处理的错误都会触发 `window`是对象的 `error` 事件
- `onerror` 事件处理程序**不会创建EVENT对象**

```js
// 阻止浏览器错误报告行为
window.onerror = function(message, url, line){
	console.log(message); //
	return false;
}
```

- 图像加载失败也会在自身触发 `error` 事件

####常见的错误类型

#####类型转换错误

- 类型转换错误发生在使用某个操作符，或其他可能会自动转换值的数据类型
- 使用 `===` 全等操作符 或 `==` 非全等操作符，可以避免因引发类型转换错误
- **不要在流程控制语句中使用非布尔值**

```js
function concat(str1, str2, str3){
	var str = str1 + str2;
	if(str3){ // 绝对不要这样
		str += str3
	}
	if(typeof str3 == 'string'){ // 恰当
		str += str3
	}
}
```

#####数据类型错误

- 在传值时，验证数据类型

#####通信错误

- 将数据发送给服务器之前，适应 `encodeURIComponent()` 进行编码